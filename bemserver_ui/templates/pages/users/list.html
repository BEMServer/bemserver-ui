{% extends "pages/base.html" %}

{% set title = "User accounts" %}

{% block main_toolbar %}
{{ super() -}}
{% filter indent(width=20, first=True) %}
<a href="{{ url_for('users.create') }}" class="btn btn-sm btn-outline-primary" title="Add a new user"><i class="bi bi-plus-circle"></i> New user account</a>
{% endfilter %}
{% endblock main_toolbar %}

{% block main_content %}
{{ super() -}}
<div class="container-fluid">
    <div class="row mb-3">
        <div class="col">
            <div class="accordion" id="accordionFilters">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingFilters">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFilters" aria-controls="collapseFilters">
                            <span class="fw-bold text-secondary"><i class="bi bi-funnel"></i> Filters</span>
                        </button>
                    </h2>
                    <div id="collapseFilters" class="accordion-collapse collapse" aria-labelledby="headingFilters" data-bs-parent="#accordionFilters">
                        <div class="accordion-body">
                            <form class="d-sm-flex d-grid gap-2" action="{{ url_for(request.endpoint) }}" method="POST">
                                <select class="form-select form-select-sm{% if filters['is_admin'] is not none %} border border-info{% endif %}" id="is_admin" name="is_admin" aria-label="Select a filter value">
                                    {% for val, label in {"None": "Select a role", "True": "Only admin", "False": "Only NOT admin"}.items() %}
                                    <option value="{{ val }}"{% if val == filters["is_admin"]|string %} selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                </select>
                                <select class="form-select form-select-sm{% if filters['is_active'] is not none %} border border-info{% endif %}" id="is_active" name="is_active" aria-label="Select a filter value">
                                    {% for val, label in {"None": "Select a status", "True": "Only active", "False": "Only inactive"}.items() %}
                                    <option value="{{ val }}"{% if val == filters["is_active"]|string %} selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                </select>
                                <button class="btn btn-sm btn-outline-info text-nowrap" type="submit" title="Apply filters"><i class="bi bi-funnel"></i> Apply</button>
                                <a class="btn btn-sm btn-outline-secondary text-nowrap" role="button" href="{{ url_for(request.endpoint) }}" title="Remove filters"><i class="bi bi-eraser"></i> Remove</a>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row justify-content-end mb-3">
        <div class="col-auto">
            Current items count: <span class="fw-bold">{{ users|length }}</span>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div class="list-group">
                {% for x in users %}
                <a class="list-group-item list-group-item-action d-flex gap-3 py-3{% if not x.is_active %} text-muted bg-warning bg-opacity-50{% endif %}" href="{{ url_for('users.view', id=x.id) }}" title="View details">
                    {% if x.id == signed_user.id %}
                    <i class="bi bi-incognito"></i>
                    {% else %}
                    <i class="bi bi-postcard"></i>
                    {% endif %}
                    <div class="d-flex gap-2 w-100 justify-content-between">
                        <div>
                            <h6 class="mb-0">
                                <span class="fw-bold">{{ x.name }}</span>
                                {% if x.id == signed_user.id %}
                                <small class="opacity-50 text-nowrap text-success fst-italic"><i class="bi bi-arrow-bar-left"></i> This is me!</small>
                                {% endif %}
                            </h6>
                            <p class="mb-0 opacity-75">{{ x.email }}</p>
                        </div>
                        <div class="d-flex flex-column">
                            {% if x.is_admin %}
                            <small class="opacity-50 text-nowrap"><i class="bi bi-lightning-fill text-success"></i> admin</small>
                            {% endif %}
                            {% if not x.is_active %}
                            <small class="opacity-50 text-danger text-nowrap"><i class="bi bi-lock-fill"></i> disabled</small>
                            {% endif %}
                        </div>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock main_content %}